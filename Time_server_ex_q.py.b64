import sys, socket, select, time

def main():
    if len(sys.argv) != 1:
        print("Error! Provide a port number!")
        return -1

    serving_sck = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    serving_sck.bind(('127.0.0.1', int(argv[1])))
    serving_sck.listen(1)

    connected_scks = []

    while True:
        if select.select([serving_sck], [], [], 60)[0] == []:
            break
        else:
            connected_scks.append(serving_sck.accept()[0])
    try:
        while True:
            if select.select([], [], [], 5)[0] == []:
                for sck in connected_scks:
                    sck.sendall(time.strftime("%H:%M:%S").encode())
    except KeyboardInterrupt:
        for sck in connected_scks:
            sck.close()
        serving_sck.close()
        return 0

if __name__ == '__main__':
    main()